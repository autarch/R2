<&| /lib/filter/yui/row.mas &>
<div id="summary">
  <h1><% $title %></h1>
</div>

<&| /lib/filter/form.mas &>
<form class="JS-standard-form" action="/contact" method="post"
      enctype="multipart/form-data">

  <input type="hidden" name="contact_type" value="person" />

  <fieldset>
    <legend>The Basics</legend>

    <div class="form-item">
      <label class="for-field" for="salutation">Salutation:</label>
      <input type="text" class="text narrow" name="salutation" id="salutation" />
      <div class="help-text">
        <p>
          Mr., Ms., Dr., etc.
        </p>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" for="first_name">First name:</label>
      <input type="text" class="text" name="first_name" id="first_name" />
    </div>

    <div class="form-item">
      <label class="for-field" for="middle_name">Middle name:</label>
      <input type="text" class="text" name="middle_name" id="middle_name" />
    </div>

    <div class="form-item">
      <label class="for-field" for="last_name">Last name:</label>
      <input type="text" class="text" name="last_name" id="last_name" />
    </div>

    <div class="form-item">
      <label class="for-field" for="suffix">Name suffix:</label>
      <input type="text" class="text narrow" name="suffix" id="suffix" />
      <div class="help-text">
        <p>
          Jr., Esq., etc.
        </p>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" for="birth_date">Birth date:</label>
      <input type="text" class="text narrow date" name="birth_date" id="birth_date" />
      <input type="hidden" name="date_format" value="<% $c->user()->date_format() %>" />
      <div class="help-text">
        <p>
          <% $c->user()->date_format_for_display() %>
        </p>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" for="last_name">Gender:</label>
      <select name="gender">
        <option value="">-- pick a gender --</option>
% for my $value ( @{ R2::Schema::Person->GenderValues() } ) {
        <option value="<% $value %>"><% $value %></option>
% }
      </select>
    </div>

    <div class="form-item">
      <label class="for-field" >Mail is ok?</label>
      <div class="radio-group">
        <input type="radio" class="radio" name="allows_mail" id="allows_mail-yes" value="1" checked="checked" />
        <label class="for-radio selected" for="allows_mail-yes" id="for-allows_mail-yes">Yes</label>
        <input type="radio" class="radio" name="allows_mail" id="allows_mail-no" value="0" />
        <label class="for-radio" for="allows_mail-no" id="for-allows_mail-no">No</label>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" >Calls are ok?</label>
      <div class="radio-group">
        <input type="radio" class="radio" name="allows_phone" id="allows_phone-yes" value="1" checked="checked" />
        <label class="for-radio selected" for="allows_phone-yes" id="for-allows_phone-yes">Yes</label>
        <input type="radio" class="radio" name="allows_phone" id="allows_phone-no" value="0" />
        <label class="for-radio" for="allows_phone-no" id="for-allows_phone-no">No</label>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" >Trading is ok?</label>
      <div class="radio-group">
        <input type="radio" class="radio" name="allows_trade" id="allows_trade-yes" value="1" />
        <label class="for-radio" for="allows_trade-yes" id="for-allows_trade-yes">Yes</label>
        <input type="radio" class="radio" name="allows_trade" id="allows_trade-no" value="0" checked="checked" />
        <label class="for-radio selected" for="allows_trade-no" id="for-allows_trade-no">No</label>
      </div>

      <div class="help-text">
        <p>
          Can this contact be traded to other organizations?
        </p>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" for="image">Image:</label>
      <input type="file" class="file" name="image" id="image" />

      <div class="help-text">
        <p>
          A GIF, JPG, or PNG. Images will be resized so they are no larger than 100x100.
        </p>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" for="note">Note:</label>
      <textarea class="short wide"></textarea>
    </div>

  </fieldset>

  <fieldset>
    <legend>Email & Website</legend>

    <div class="form-item">
      <label class="for-field" for="email_address">Email address:</label>
      <input type="text" class="text medium" name="email_address" id="email_address" />
    </div>

    <div class="form-item">
      <label class="for-field" for="allows_email">Email is ok?</label>

      <div class="radio-group">
        <input type="radio" class="radio" name="allows_email" id="allows_email-yes" value="1" checked="checked" />
        <label class="for-radio selected" for="allows_email-yes" id="for-allows_email-yes">Yes</label>
        <input type="radio" class="radio" name="allows_email" id="allows_email-no" value="0" />
        <label class="for-radio" for="allows_email-no" id="for-allows_email-no">No</label>
      </div>

      <div class="help-text">
        <p>
          If set to "No", then you will not be able to send mail to this contact via Rapport.
        </p>
      </div>
    </div>

    <div class="form-item">
      <label class="for-field" for="website">Website:</label>
      <input type="text" class="text medium" name="website" id="website" />
    </div>

  </fieldset>

  <fieldset>
    <legend>Phone Numbers</legend>

    <div class="JS-repeatable-group JS-repeatable-group-phone-number">
      <div class="form-item">
        <label class="for-field" for="phone_number-new1" id="for-phone_number-new1">Phone number:</label>
        <select name="phone_number_type_id-new1">
% for my $type (@phone_number_types) {
          <option value="<% $type->phone_number_type_id() %>"><% $type->name() %></option>
% }
        </select>
        <input type="text" class="text" name="phone_number-new1" id="phone_number-new1" />
        <a class="delete-repeated-group" style="display: none" href="#" title="delete this phone number">X</a>
      </div>

      <div class="form-item">
        <label class="secondary" for="phone_number_notes-new1">notes:</label>
        <input type="text" class="text wide" name="phone_number_notes-new1" id="phone_number_notes-new1" />
      </div>

      <div class="form-item">
        <div class="no-label">
          <input type="radio" name="phone_number_is_preferred" value="new1" checked="checked" id="phone_number_is_preferred-new1" />
          <label class="for-radio selected" for="phone_number_is_preferred-new1"
                 id="for-phone_number_is_preferred-new1">This is the preferred number</label>
        </div>
      </div>
    </div>

    <a href="#" class="add-another" id="phone-number-repeater">Add another phone number</a>

  </fieldset>

  <fieldset class="last">
    <legend>Addresses</legend>

    <div class="JS-repeatable-group JS-repeatable-group-address">
      <div class="form-item">
        <label class="for-field" for="address-new1" id="for-address-new1">Address:</label>
        <select name="address_type_id-new1">
% for my $type (@address_types) {
          <option value="<% $type->address_type_id() %>"><% $type->name() %></option>
% }
        </select>
        <a class="delete-repeated-group" style="display: none" href="#" title="delete this address">X</a>
      </div>

      <div class="form-item">
        <label class="secondary" for="street_1-new1">Line 1:</label>
        <input type="text" class="text" name="street_1-new1" id="street_1-new1" />
      </div>

      <div class="form-item">
        <label class="secondary" for="street_2-new1">Line 2:</label>
        <input type="text" class="text" name="street_2-new1" id="street_2-new1" />
      </div>

      <div class="form-item">
        <label class="secondary" for="city-new1">City:</label>
        <input type="text" class="text" name="city-new1" id="city-new1" />
      </div>

      <div class="form-item">
        <label class="secondary" for="region-new1">State/Region:</label>
        <input type="text" class="text" name="region-new1" id="region-new1" />
      </div>

      <div class="form-item">
        <label class="secondary" for="postal_code-new1">Postal code:</label>
        <input type="text" class="text" name="postal_code-new1" id="postal_code-new1" />
      </div>

      <div class="form-item">
        <label class="secondary" for="iso_code-new1">Country:</label>
% if ( @countries > 1 )  {
        <select name="iso_code-new1" id="iso_code-new1" />
%   for my $country (@countries) {
          <option value="<% $country->iso_code() %>"><% $country->name() %></option>
%   }
% } else {
        <div class="text-for-hidden"><% $countries[0]->name() %></div>
        <input type="hidden" name="iso_code" value="<% $countries[0]->iso_code() %>" />
% }
      </div>

      <div class="form-item">
        <label class="secondary" for="address_notes-new1">notes:</label>
        <input type="text" class="text wide" name="address_notes-new1" id="address_notes-new1" />
      </div>

      <div class="form-item">
        <div class="no-label">
          <input type="radio" name="address_is_preferred" value="new1" checked="checked" id="address_is_preferred-new1" />
          <label class="for-radio selected" for="address_is_preferred-new1"
                 id="for-address_is_preferred-new1">This is the preferred address</label>
        </div>
      </div>
    </div>

    <a href="#" class="add-another" id="address-repeater">Add another address</a>

  </fieldset>

  <div class="form-item">
    <input class="submit" type="submit" value="Submit" />
  </div>

</form>
</&>
</&>

<%shared>
my $title = 'Add a new person';
</%shared>

<%init>
my @phone_number_types = @{ $c->user()->account()->person_phone_number_types() };
my @address_types = @{ $c->user()->account()->person_address_types() };
my @countries = $c->user()->account()->countries()->all();
</%init>

<%method title>
<% $title %>
</%method>
