<div id="summary">
  <h1><& SELF:title, %ARGS &> <& /lib/contact-view/contact-icon.mas, contact => $contact &></h1>
</div>

% if ( $contact->donation_count() ) {
<table class="standard-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Amount</th>
      <th>Gift</th>
      <th>Trans.</th>
      <th>Source</th>
      <th>Target</th>
      <th>Payment</th>
      <th>Receipt</th>
%   if ($can_edit_donations) {
      <th></th>
      <th></th>
%   }
    </tr>
  </thead>
%   while ( my $donation = $donations->next() ) {
  <tbody>
    <tr class="<% $donations->index() % 2 ? 'odd' : 'even' %>">
      <td><% $c->user()->format_date( $donation->donation_date() ) %></td>
      <td>$<% $donation->amount() %></td>
      <td>$<% $donation->value_for_donor() %></td>
      <td>$<% $donation->transaction_cost() %></td>
      <td><% $donation->source()->name() %></td>
      <td><% $donation->target()->name() %></td>
      <td><% $donation->payment_type()->name() %></td>
      <td><% $donation->receipt_sent() ? 'yes' : 'no' %></td>
%     if ($can_edit_donations) {
      <td><a href="<% $donation->uri( view => 'edit_form' ) %>">Edit</a></td>
      <td>
        <form class="inline" action="<% $donation->uri( view => 'confirm_deletion' ) %>" method="GET">
          <input type="submit" class="submit" value="Delete" />
        </form>
      </td>
%     }
    </tr>
%      if ( my $note = $donation->note() ) {
    <tr class="<% $donations->index() % 2 ? 'odd' : 'even' %> note">
      <td colspan="<% $can_edit_donations ? 7 : 5 %>"><% format_note( $note ) | n %></td>
    </tr>
%      }
  </tbody>
%   }
</table>
% } else {
<p>
<% $real_contact->display_name() %> has not made any donations.
</p>
% }

% if ($can_edit_donations) {
<& /lib/form/donation.mas, contact => $contact &>
% }

<%args>
$contact
$real_contact
$can_edit_donations
</%args>

<%init>
my $donations = $contact->donations();
</%init>

<%method title>
Donations from <% $real_contact->display_name() %>
<%args>
$real_contact
</%args>
</%method>
