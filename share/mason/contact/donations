<div id="summary">
  <h1><& SELF:title, %ARGS &> <& /lib/contact-view/contact-icon.mas, contact => $contact &></h1>
</div>

% if ($can_edit_donations) {
<p>
  <a href="<% $contact->uri( view => 'new_donation_form' ) %>">Record a new donation</a>.
</p>
% }

% if ( $contact->donation_count() ) {
<table class="standard-table">
  <thead>
    <tr>
      <th>Date</th>
      <th>Amount</th>
      <th>Gift</th>
      <th>Trans.</th>
      <th>Source</th>
      <th>Campaign</th>
      <th>Payment</th>
      <th>Receipt</th>
%   if ($can_edit_donations) {
      <th></th>
      <th></th>
%   }
    </tr>
  </thead>
%   while ( my $donation = $donations->next() ) {
  <tbody>
    <tr class="<% $donations->index() % 2 ? 'odd' : 'even' %>">
      <td><% $c->user()->format_date( $donation->donation_date() ) %></td>
      <td><% $format->format_price( $donation->amount() ) %></td>
      <td><% $format->format_price( $donation->value_for_donor() ) %></td>
      <td><% $format->format_price( $donation->transaction_cost() ) %></td>
      <td><% $donation->source()->name() %></td>
      <td><% $donation->campaign()->name() %></td>
      <td><% $donation->payment_type()->name() %></td>
      <td><% $donation->receipt_date() ? $c->user()->format_date( $donation->receipt_date() ): 'not sent' %></td>
%     if ($can_edit_donations) {
      <td><a href="<% $donation->uri( view => 'edit_form' ) %>">Edit</a></td>
      <td>
        <form class="inline" action="<% $donation->uri( view => 'confirm_deletion' ) %>" method="get">
          <input type="submit" class="submit" value="Delete" />
        </form>
      </td>
%     }
    </tr>
%      if ( my $note = $donation->note() ) {
    <tr class="<% $donations->index() % 2 ? 'odd' : 'even' %> note">
      <td colspan="<% $can_edit_donations ? 10 : 8 %>"><% format_note( $note ) | n %></td>
    </tr>
%      }
  </tbody>
%   }
</table>

<ul class="table-summary donation-totals">
  <li>Total for the last 12 months: <% $format->format_price( $contact->donation_total( since => DateTime->today()->subtract( months => 12 ) ) ) %></li>
  <li>Total for all time: <% $format->format_price( $contact->donation_total() ) %></li>
</ul>

% } else {
<p>
<% $real_contact->display_name() %> has not made any donations.
</p>
% }

<%args>
$contact
$real_contact
$can_edit_donations
</%args>

<%init>
my $donations = $contact->donations();
my $format = Number::Format->new( INT_CURR_SYMBOL => '$' );
</%init>

<%method title>
Donations from <% $real_contact->display_name() %>
<%args>
$real_contact
</%args>
</%method>
